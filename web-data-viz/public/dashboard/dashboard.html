<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>


    <link rel="stylesheet" href="./../css/dashboard.css">
    <link rel="icon" href="../assets/imgs/logoBanguela.png">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>


<body onload="graficoBar(); graficoRadar(); graficoPizza(); kpiBar(); kpiPie();kpiRadar()">

    <div class="dashboard">
        <div class="conteudo">
            <div class="menu">
                <img src="../assets/imgs/logoBanguela.png" alt="">
                <a href="dashboard.html" class="page" style="color: #026873;">Iníco</a>
                <a href="../perguntas.html">Refazer quiz</a>
                <button onclick="sair()">Sair</button>
            </div>
            <div class="graficos">
                <div class="mensagem">
                    <p>Olá <b id="usuario">visitante</b>, seja Bem-Vindo!!!</p>
                </div>
                <div class="kpis">
                    <div class="pontos">
                        <h2>Personagem com mais pontos</h2>
                        <p id="personagemMais"></p>
                    </div>
                    <div class="personalidade">
                        <h2>Personalidade mais forte</h2>
                        <p id="personalidadeMais"></p>
                    </div>
                    <div class="todos">
                        <h2>Personagem que mais apareceu globalmente</h2>
                        <p id="personagemGlobal"></p>
                    </div>
                </div>
                <div class="grafico">
                    <div class="barras">
                        <h4>Resultado do seu quiz</h4>
                        <canvas id="chartbar"></canvas>
                    </div>
                    <div class="radar">
                        <h4>Resultado da sua personalidade</h4>
                        <canvas id="chartradar"></canvas>
                    </div>
                    <div class="global">
                        <h4>Personagens que apareceram no quiz dos outros</h4>
                        <canvas id="chartpie"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>

<script>

function sair() {
    window.location = "../index.html"
}

    function graficoBar() {
        var fkusuarioVar = sessionStorage.ID_USUARIO
        console.log(fkusuarioVar)
        usuario.innerHTML = sessionStorage.NOME_USUARIO;
        fetch("/medidas/resultadoQuiz", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idServer: fkusuarioVar,
            }),
        }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    let soluco = 0
                    let astrid = 0
                    let melequento = 0
                    let pernadepeixe = 0
                    let cabecadura = 0
                    let cabecaquente = 0

                    resposta.forEach(item => {
                        soluco = item.Soluço
                        astrid = item.Astrid
                        melequento = item.Melequento
                        pernadepeixe = item.PernadePeixe
                        cabecadura = item.CabeçaDura
                        cabecaquente = item.CabeçaQuente
                    });

                    const ctxbar = document.getElementById('chartbar');
                    new Chart(ctxbar, {
                        type: 'bar',
                        data: {
                            labels: ['Personagens'],
                            datasets: [{
                                label: 'Soluco',
                                data: [soluco],
                                backgroundColor: '#FCD77C',
                                pointRadius: 4.5,
                                borderWidth: 0,
                            },
                            {
                                label: 'Astrid',
                                data: [astrid],
                                backgroundColor: '#FC7CAD',
                                pointRadius: 4.5,
                                borderWidth: 0,


                            },
                            {
                                label: 'Melequento',
                                data: [melequento],
                                backgroundColor: '#7CFC84',
                                pointRadius: 4.5,
                                borderWidth: 0,


                            },
                            {
                                label: 'Perna-de-peixe',
                                data: [pernadepeixe],
                                backgroundColor: '#7CA1FC',
                                pointRadius: 4.5,
                                borderWidth: 0,


                            },
                            {
                                label: 'Cabeça-Dura',
                                data: [cabecadura],
                                backgroundColor: '#7D7665',
                                pointRadius: 4.5,
                                borderWidth: 0,


                            },
                            {
                                label: 'Cabeça-Quente',
                                data: [cabecaquente],
                                backgroundColor: '#8AA78C',
                                pointRadius: 4.5,
                                borderWidth: 0,


                            }],

                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'x',
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: { display: true, text: 'Nível de Proximidade %' },
                                }
                            }
                        }
                    });

                })
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }


    
    const ctxradar = document.getElementById("chartradar")
    function graficoRadar() {
        var fkusuarioVar = sessionStorage.ID_USUARIO
        fetch("/medidas/resultadoPersona", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idServer: fkusuarioVar,
            }),
        }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    let soluco = 0
                    let astrid = 0
                    let melequento = 0
                    let pernadepeixe = 0
                    let cabecadura = 0
                    let cabecaquente = 0

                    resposta.forEach(item => {
                        soluco = item.Soluço
                        astrid = item.Astrid
                        melequento = item.Melequento
                        pernadepeixe = item.Perna_de_Peixe
                        cabecadura = item.Cabeça_Dura
                        cabecaquente = item.Cabeça_Quente
                    });

                    new Chart(ctxradar, {
                        type: 'radar',
                        data: {
                            labels: [
                                'Inovador',
                                'Determinação',
                                'Sarcarsmo',
                                'Sábio',
                                'Impulsivo',
                                'Arrogante'
                            ],
                            datasets: [
                                {
                                    label: 'Radar de Personalidade',
                                    data: [soluco, astrid, melequento, pernadepeixe, cabecadura, cabecaquente],
                                    fill: false,
                                    backgroundColor: 'red',
                                    borderColor: 'red',
                                    backgroundColor: 'red',
                                    pointBorderColor: 'red'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            elements: {
                                line: {
                                    borderWidth: 3
                                }
                            },
                            scales: {
                                r: {
                                    pointLabels: {
                                        backdropColor: 'rgba(0,0,0,0)'
                                    },
                                    ticks: {
                                        backdropColor: 'rgba(0,0,0,0)'
                                    }
                                }
                            }
                        }
                    });

                })
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    
    
    
    const ctxpie = document.getElementById('chartpie');

    function graficoPizza() {
        var fkusuarioVar = sessionStorage.ID_USUARIO
        fetch("/medidas/resultadoGlobal", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idServer: fkusuarioVar,
            }),
        }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    let soluco = 0
                    let astrid = 0
                    let melequento = 0
                    let pernadepeixe = 0
                    let cabecadura = 0
                    let cabecaquente = 0

                    resposta.forEach(item => {
                        soluco = item.Soluco
                        astrid = item.Astrid
                        melequento = item.Melequento
                        pernadepeixe = item.Perna_de_Peixe
                        cabecadura = item.Cabeca_Dura
                        cabecaquente = item.Cabeca_Quente
                    });


                    new Chart(ctxpie, {
                        type: 'pie',
                        data: {
                            labels: ['Soluço', 'Astrid', 'Melequento', 'Perna-de-peixe', 'Cabeça-Dura', 'Cabeça-Quente'],
                            datasets: [{
                                label: 'Aparições',
                                data: [soluco, astrid, melequento, pernadepeixe, cabecadura, cabecaquente],
                                backgroundColor: [
                                    '#FCD77C',
                                    '#FC7CAD',
                                    '#7CFC84',
                                    '#7CA1FC',
                                    '#7D7665',
                                    '#8AA78C'
                                ],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true
                        }
                    });

                })
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function kpiBar () {
        var fkusuarioVar = sessionStorage.ID_USUARIO
        let nomePersonagem = document.getElementById("personagemMais")
        fetch("/medidas/resultadoKpiBar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idServer: fkusuarioVar,
            }),
        }).then(
            function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    resposta.forEach(item => {
                        nomePersonagem.innerHTML = item.PersonagemVencedor
                        
                    });
                })
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function kpiRadar () {
        var fkusuarioVar = sessionStorage.ID_USUARIO
        let personalidade = document.getElementById("personalidadeMais")
        fetch("/medidas/resultadoKpiRadar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idServer: fkusuarioVar,
            }),
        }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    resposta.forEach(item => {
                        personalidade.innerHTML = item.UltimaPersonalidade
                        
                    });

                })
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function kpiPie () {
        var fkusuarioVar = sessionStorage.ID_USUARIO
        let nomePersonagemGlobal = document.getElementById("personagemGlobal")
        fetch("/medidas/resultadoKpiGlobal", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idServer: fkusuarioVar,
            }),
        }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    nomePersonagemGlobal.innerHTML = resposta.personagem
                    resposta.forEach(item => {
                        nomePersonagemGlobal.innerHTML = item.personagem
                        
                    });
                })
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }







</script>