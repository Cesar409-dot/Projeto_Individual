<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <link rel="stylesheet" href="./css/perguntas.css">
    <link rel="icon" href="./assets/imgs/logoBanguela.png">
</head>

<body>

   <div id="container">

    <!-- Botão que inicia o quiz. Antes de clicar nele nada aparece. -->
    <button id="btnIniciar" onclick="iniciarQuiz()">Iniciar Quiz</button>

    <!-- Container do quiz (perguntas e respostas), escondido até o usuário clicar em "Iniciar" -->
    <div id="quizContainer">

        <h2>Quiz de Personalidade</h2>

        <!-- Exibe qual número da pergunta o usuário está respondendo -->
        <p id="infoQuestao"></p>

        <!-- Texto principal da pergunta -->
        <p id="pergunta"></p>

        <!-- Espaço onde as opções da pergunta são inseridas dinamicamente -->
        <div id="opcoes"></div>

        <!-- Botões de navegação -->
        <div id="botoesNavegacao">
            <button id="btnVoltar" onclick="voltar()">Voltar</button>
            <button id="btnAvancar" onclick="avancar()">Avançar</button>
        </div>
    </div>

    <!-- Resultado final, aparece só depois da última pergunta -->
    <div id="resultado"></div>

</div>


    <script>
// Lista de perguntas do quiz
const perguntas = [
    {
        pergunta: "1. O que mais te faz perder a paciência",
        opcoes: ["Falta de lógica", "Falta de comprometimento", "Rotina chata", "Bagunça sem necessidade", "Regras demais", "Não receber reconhecimento"],
        pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    },
    {
        pergunta: "2. O que te motiva?",
        opcoes: ["Criar algo diferente", "Superar desafios", "Se divertir", "Entender o mundo", "Buscar emoção", "Ser o melhor"],
        pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    },
    {
        pergunta: "3. Qual ambiente te faz sentir mais confortável?",
        opcoes: ["Um lugar cheio de possibilidades", "Um espaço organizado e produtivo", "Um lugar onde posso ser imprevisível", "Um ambiente tranquilo e estável", "Algo cheio de movimento", "Um lugar onde eu possa mostrar minhas habilidades"],
        pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    },
    {
        pergunta: "4. Qual dessas frases mais combina com você?",
        opcoes: ["“Tudo tem outra forma de ser feito.”", "“Disciplina traz resultados.”", "“A vida é muito curta para ser séria demais.”", "“Conhecimento é meu guia.”", "“Vamos ver no que dá.”", "“Eu sei do que sou capaz.”"],
        pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    },
    {
        pergunta: "5.O que você mais valoriza em si mesmo?",
        opcoes: ["Criatividade", "Determinação", "Espontaneidade", "Sabedoria", "Coragem", "Autoconfiança"],
        pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    },
    {
        pergunta: "6. Como você toma decisões importantes?",
        opcoes: ["Pesquisando e considerando novas alternativas", "Pensando nos objetivos e no resultado", "Seguindo o que parece mais divertido", "Avaliando prós e contras com calma", "Tomando a decisão rapidamente", "Escolhendo o que te deixa em destaque"],
        pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    },
    {
        pergunta: "7. Como você lida com críticas?",
        opcoes: ["Reflete e tenta melhorar", "Usa como motivação", "Não leva muito a sério", "Analisa se faz sentido", "Impulsivamente", "Defendendo seu ponto com firmeza"],
    pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    },
    {
        pergunta: "8. Quando algo dá errado, você…",
        opcoes: ["Reimagina o plano", "Corrige e segue", "Tenta de outro jeito", "Analisa o que falhou", "Age de novo rapidamente", "Se esforça para provar que dá conta"],
       pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    },
    {
        pergunta: "9. O que você costuma fazer ao começar algo novo?",
        opcoes: ["Testar ideias diferentes", "Criar um plano claro", "Seguir o que der vontade na hora", "Pesquisar primeiro", "Mergulhar sem pensar muito", "Tentar ser o melhor desde o início"],
        pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    },
    {
        pergunta: "10. Qual é sua maior força social?",
        opcoes: ["Empatia", "Confiabilidade", "Humor", "Escuta", "Energia", "Segurança"],
        pontos: [["soluco"], ["astrid"], ["melequento"], ["pernaDePeixe"], ["cabecaDura"], ["cabecaQuente"]]
    }
];


// Lista de personagens usada para percorrer mais fácil
const listaPersonagens = ["soluco", "astrid", "cabecaQuente", "melequento", "pernaDePeixe", "cabecaDura"];

// Pontuação inicial de cada personagem
const pontuacaoPersonagens = {
    soluco: 0,
    astrid: 0,
    cabecaQuente: 0,
    melequento: 0,
    pernaDePeixe: 0,
    cabecaDura: 0
};

// Guarda qual pergunta está sendo mostrada
let perguntaAtual = 0;

// Guarda as respostas do usuário
const respostasDoUsuario = {};

// Pegando elementos do HTML
const quizContainer = document.getElementById("quizContainer");
const infoQuestao = document.getElementById("infoQuestao");
const textoPergunta = document.getElementById("pergunta");
const containerOpcoes = document.getElementById("opcoes");
const botaoVoltar = document.getElementById("btnVoltar");
const botaoAvancar = document.getElementById("btnAvancar");
const containerResultado = document.getElementById("resultado");
const botaoIniciar = document.getElementById("btnIniciar");

// Função para iniciar o quiz
function iniciarQuiz() {
    botaoIniciar.style.display = "none";
    quizContainer.style.display = "block";
    carregarPergunta();
}

// Carrega pergunta na tela
function carregarPergunta() {
    const p = perguntas[perguntaAtual];

    infoQuestao.textContent = `Pergunta ${perguntaAtual + 1} de ${perguntas.length}`;

    if (perguntaAtual === perguntas.length - 1) {
        alert("Atenção! Você está prestes a responder a última pergunta!");
    }

    textoPergunta.textContent = p.pergunta;

    containerOpcoes.innerHTML = "";

    // forEach = repete algo para cada item da lista
    p.opcoes.forEach((opcao, i) => {
        const label = document.createElement("label");
        const input = document.createElement("input");

        input.type = "checkbox";
        input.name = "opcao";
        input.value = i;

        if (respostasDoUsuario[perguntaAtual] === i) {
            input.checked = true;
        }

        // Garante apenas 1 marcado
        input.onclick = () => {
            document.querySelectorAll("input[name='opcao']").forEach(cb => cb.checked = false);
            input.checked = true;
            respostasDoUsuario[perguntaAtual] = i;
        };

        label.appendChild(input);
        label.append(" " + opcao);

        containerOpcoes.appendChild(label);
        containerOpcoes.appendChild(document.createElement("br"));
    });

    botaoVoltar.style.display = perguntaAtual === 0 ? "none" : "inline-block";

    botaoAvancar.textContent = perguntaAtual === perguntas.length - 1 ? "Finalizar" : "Avançar";
}

// Avança para próxima pergunta ou finaliza
function avancar() {
    if (respostasDoUsuario[perguntaAtual] === undefined) {
        alert("Selecione uma resposta para continuar.");
        return;
    }

    if (perguntaAtual < perguntas.length - 1) {
        perguntaAtual++;
        carregarPergunta();
    } else {
        calcularResultado();
    }
}

// Volta uma pergunta
function voltar() {
    if (perguntaAtual > 0) {
        perguntaAtual--;
        carregarPergunta();
    }
}

// Calcula o resultado final
function calcularResultado() {
    // Zera pontuações usando forEach
    listaPersonagens.forEach(p => {
        pontuacaoPersonagens[p] = 0;
    });

    // Loop para somar pontos das respostas
    for (let indicePergunta in respostasDoUsuario) {
        const indiceResposta = respostasDoUsuario[indicePergunta];
        const personagens = perguntas[indicePergunta].pontos[indiceResposta];

        // Cada personagem recebe 1 ponto
        personagens.forEach(p => {
            pontuacaoPersonagens[p]++;
        });
    }
    fetch("/usuarios/perguntar", {
        method: "POST",
        headers: {
    "Content-Type": "application/json",
},
    body: JSON.stringify({
    solucoServer:pontuacaoPersonagens.soluco,
    astridServer:pontuacaoPersonagens.astrid,
    cabecaQuenteServer:pontuacaoPersonagens.cabecaQuente,
    melequentoServer:pontuacaoPersonagens.melequento,
    pernaDePeixeServer:pontuacaoPersonagens.pernaDePeixe,
    cabecaDuraServer:pontuacaoPersonagens.cabecaDura,
    idServer:sessionStorage.ID_USUARIO
    }),
})

    let personagemFinal = "";
    let maior = -1;

    // Achar o personagem com maior pontuação
    listaPersonagens.forEach(p => {
        if (pontuacaoPersonagens[p] > maior) {
            maior = pontuacaoPersonagens[p];
            personagemFinal = p;
        }
    });

    quizContainer.style.display = "none";

    containerResultado.style.display = "block";
    containerResultado.innerHTML = `
        <img src="./assets/imgs/${personagemFinal}2.jpg" alt="Imagem do personagem">
        
        <h2>Seu personagem é:</h2>
        <h1>${personagemFinal.toUpperCase()}</h1>
        <p>${{
            soluco: "Você sempre pensa antes de agir. Gosta de ajudar as pessoas. Prefere resolver o problema na calma. Aprende as coisas rápido. Sempre tenta fazer o que você acha que é certo.",
            astrid: "Você é corajoso. Não foge de desafios, não importa s são difíceis. Protege quem gosta com unhas e dentes. Determinado ao extremo. Lidera sem medo de suas escolhas, tem total certeza delas.",
            cabecaQuente: "Explosivo e intenso. Age muito rápido. Fala o que pensa na hora. Incansável quando quer algo de alguém. Sempre pronto para o que der e vier.",
            melequento: "Criativo e destemido. Improvisa muito bem. Tem um humor forte  cativante. Sempre dá um jeito, não importa se é um jeito ruim.",
            pernaDePeixe: "Curioso e estudioso. Analisa tudo quando pode. Sempre observando as coisas a sua volta. Aprende com detalhes. Pensamento estratégico.",
            cabecaDura: "Teimoso mas forte. Não desiste fácil do que quer. Resiste a tudo. Vai até o fim, mesmo se te derrubarem um milhão de vezes. Determinação é seu maior poder."
        }[personagemFinal]}</p>
        <button onclick="reiniciarQuiz()">Refazer Quiz</button>
        <button onclick="irParaDashboard()">Ver Gráficos</button>
    `;
}

// Reinicia tudo
function reiniciarQuiz() {
    listaPersonagens.forEach(p => {
        pontuacaoPersonagens[p] = 0;
    });

    // remove cada resposta usando entries + forEach
Object.entries(respostasDoUsuario).forEach(([chave]) => {
    delete respostasDoUsuario[chave]
})

    perguntaAtual = 0;

    containerResultado.style.display = "none";
    botaoIniciar.style.display = "block";
}

function irParaDashboard() {
    window.location = "./dashboard/dashboard.html"
}


</script>

</body>
</html>
